<<<<<<< HEAD
}else{
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[1],
vec_stderr=.summary_betas_slope_SP[2],
vec_true=minimal_change_baseline)
}
.params_in_ci <- sapply(1:length(.params_in_ci), function(i){
## for the ones in which there is a change, say whether it's up- or down-regulated
if(.params_in_ci[i]){
## if there is a change
if(!is.null(dim(.summary_betas_slope_SP))){
## one-dim
if(.summary_betas_slope_SP[1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}else{
## multi-dim
if(.summary_betas_slope_SP[i,1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}
}else{
'FALSE'
}
})
.params_in_ci
.params_in_ci[i]
i=1
.params_in_ci[i]
!is.null(dim(.summary_betas_slope_SP))
summary_betas_slope_SP[1]
.summary_betas_slope_SP
.summary_betas_slope_SP[1] > minimal_change_baseline
## for the ones in which there is a change, say whether it's up- or down-regulated
if(.params_in_ci[i]){
## if there is a change
if(!is.null(dim(.summary_betas_slope_SP))){
## one-dim
if(.summary_betas_slope_SP[1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}else{
## multi-dim
if(.summary_betas_slope_SP[i,1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}
}else{
'FALSE'
}
.params_in_ci[i]
!is.null(dim(.summary_betas_slope_SP))
.summary_betas_slope_SP
dim(.summary_betas_slope_SP
)
## for the ones in which there is a change, say whether it's up- or down-regulated
if(.params_in_ci[i]){
## if there is a change
if(is.null(dim(.summary_betas_slope_SP))){
## one-dim
if(.summary_betas_slope_SP[1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}else{
## multi-dim
if(.summary_betas_slope_SP[i,1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}
}else{
'FALSE'
}
perturbed_betas_diagRE_DMDL_nonexo_SP <- lapply(names(diagRE_DMDL_nonexo_SP), try(function(idx_sp){
cat(idx_sp, '\n')
.betas_SP <- data.frame(plot_betas(diagRE_DMDL_nonexo_SP[[idx_sp]], names_cats= logR_nonexo_notsorted_SP[[idx_sp]],
return_df=T, plot=F))
.slopes_minpert_SP <- .betas_SP %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
# print(.slopes_minpert_SP)
## check if the CI of the betas touches this median value
.summary_betas_slope_SP <- python_like_select_rownames(summary(diagRE_DMDL_nonexo_SP[[idx_sp]]), 'beta')[c(F,T),]
nrow(.summary_betas_slope_SP)
minimal_change_baseline <- median(c(.slopes_minpert, 0))
# print(.summary_betas_slope_SP)
# print(logR_nonexo_notsorted_SP[[idx_sp]])
# print(dim(.summary_betas_slope_SP))
if(!is.null(dim(.summary_betas_slope_SP))){
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[,1],
vec_stderr=.summary_betas_slope_SP[,2],
vec_true=rep(minimal_change_baseline, nrow(.summary_betas_slope_SP)))
}else{
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[1],
vec_stderr=.summary_betas_slope_SP[2],
vec_true=minimal_change_baseline)
}
.params_in_ci <- sapply(1:length(.params_in_ci), function(i){
## for the ones in which there is a change, say whether it's up- or down-regulated
if(.params_in_ci[i]){
## if there is a change
if(is.null(dim(.summary_betas_slope_SP))){
## one-dim
if(.summary_betas_slope_SP[1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}else{
## multi-dim
if(.summary_betas_slope_SP[i,1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}
}else{
'FALSE'
}
})
names(.params_in_ci) <- sapply(logR_nonexo_notsorted_SP[[idx_sp]], function(i) strsplit(i, '/')[[1]][1])
.baseline <- strsplit(logR_nonexo_notsorted_SP[[idx_sp]][[1]], '/')[[1]][2]
return(list(betas_perturbed=.params_in_ci, baseline=.baseline))
}))
perturbed_betas_diagRE_DMDL_nonexo_SP
knitr::opts_chunk$set(echo = TRUE, cache=TRUE)
system("open ../../results/results_TMB/pcawg/)
""
"
system("open ../../results/results_TMB/pcawg/")
give_params_in_CI
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[,1],
vec_stderr=.summary_betas_slope_SP[,2],
vec_true=rep(minimal_change_baseline, nrow(.summary_betas_slope_SP)))
give_confidence_interval
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[1],
vec_stderr=.summary_betas_slope_SP[2],
vec_true=minimal_change_baseline)
.params_in_ci
.summary_betas_slope_SP
.summary_betas_slope_SP[2]
idx_sp="CNS−Medullo"
cat(idx_sp, '\n')
.betas_SP <- data.frame(plot_betas(diagRE_DMDL_nonexo_SP[[idx_sp]], names_cats= logR_nonexo_notsorted_SP[[idx_sp]],
return_df=T, plot=F))
diagRE_DMDL_nonexo_SP$`CNS-Medullo`
idx_sp
idx_sp=:CNS-Medullo""
idx_sp="CNS-Medullo"
.betas_SP <- data.frame(plot_betas(diagRE_DMDL_nonexo_SP[[idx_sp]], names_cats= logR_nonexo_notsorted_SP[[idx_sp]],
return_df=T, plot=F))
.slopes_minpert_SP <- .betas_SP %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
# print(.slopes_minpert_SP)
## check if the CI of the betas touches this median value
.summary_betas_slope_SP <- python_like_select_rownames(summary(diagRE_DMDL_nonexo_SP[[idx_sp]]), 'beta')[c(F,T),]
nrow(.summary_betas_slope_SP)
minimal_change_baseline <- median(c(.slopes_minpert, 0))
minimal_change_baseline
c(.slopes_minpert, 0)
ct <- "Stomach−AdenoCA"
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
names(diagRE_DMDL_nonexo_SP)
ct <- "Stomach-AdenoCA"
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=F, plot=F, only_slope = T, line_zero=F, add_confint = T)
print(aaa + geom_hline(yintercept = median(c(.slopes_minpert, 0)), lty='dashed', col='blue')+ggtitle(ct)+labs(x='Log ratio of signatures')+
theme(strip.background = element_blank(), strip.text = element_blank()) )
idx_sp <- ct
idx_sp
cat(idx_sp, '\n')
.betas_SP <- data.frame(plot_betas(diagRE_DMDL_nonexo_SP[[idx_sp]], names_cats= logR_nonexo_notsorted_SP[[idx_sp]],
return_df=T, plot=F))
.slopes_minpert_SP <- .betas_SP %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
# print(.slopes_minpert_SP)
## check if the CI of the betas touches this median value
.summary_betas_slope_SP <- python_like_select_rownames(summary(diagRE_DMDL_nonexo_SP[[idx_sp]]), 'beta')[c(F,T),]
nrow(.summary_betas_slope_SP)
minimal_change_baseline <- median(c(.slopes_minpert_SP, 0))
# print(.summary_betas_slope_SP)
# print(logR_nonexo_notsorted_SP[[idx_sp]])
# print(dim(.summary_betas_slope_SP))
if(!is.null(dim(.summary_betas_slope_SP))){
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[,1],
vec_stderr=.summary_betas_slope_SP[,2]*1.96,
vec_true=rep(minimal_change_baseline, nrow(.summary_betas_slope_SP)))
}else{
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[1],
vec_stderr=.summary_betas_slope_SP[2]*1.96,
vec_true=minimal_change_baseline)
}
.params_in_ci <- sapply(1:length(.params_in_ci), function(i){
## for the ones in which there is a change, say whether it's up- or down-regulated
if(!.params_in_ci[i]){
## if there is a change: not in confidence interval
if(is.null(dim(.summary_betas_slope_SP))){
## one-dim
if(.summary_betas_slope_SP[1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}else{
## multi-dim
if(.summary_betas_slope_SP[i,1] > minimal_change_baseline){
'increase'
}else{
'decrease'
}
}
}else{
'FALSE'
}
})
names(.params_in_ci) <- sapply(logR_nonexo_notsorted_SP[[idx_sp]], function(i) strsplit(i, '/')[[1]][1])
.baseline <- strsplit(logR_nonexo_notsorted_SP[[idx_sp]][[1]], '/')[[1]][2]
.params_in_ci
.summary_betas_slope_SP[,2]*1.96
.summary_betas_slope_SP
minimal_change_baseline
median(c(.slopes_minpert, 0))
minimal_change_baseline
.params_in_ci
# print(.summary_betas_slope_SP)
# print(logR_nonexo_notsorted_SP[[idx_sp]])
# print(dim(.summary_betas_slope_SP))
if(!is.null(dim(.summary_betas_slope_SP))){
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[,1],
vec_stderr=.summary_betas_slope_SP[,2]*1.96,
vec_true=rep(minimal_change_baseline, nrow(.summary_betas_slope_SP)))
}else{
.params_in_ci <- give_params_in_CI(vec_est=.summary_betas_slope_SP[1],
vec_stderr=.summary_betas_slope_SP[2]*1.96,
vec_true=minimal_change_baseline)
}
.params_in_ci
.summary_betas_slope_SP[,2]*1.96
minimal_change_baseline
give_params_in_CI(vec_est=.summary_betas_slope_SP[9,1],
vec_stderr=.summary_betas_slope_SP[9,2]*1.96,
vec_true=rep(minimal_change_baseline, 1))
give_params_in_CI
diagRE_DMDL_nonexo_SP
aaa <- list()
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=F, plot=F, only_slope = T, line_zero=F, add_confint = T)
print(aaa + geom_hline(yintercept = median(c(.slopes_minpert, 0)), lty='dashed', col='blue')+ggtitle(ct)+labs(x='Log ratio of signatures')+
theme(strip.background = element_blank(), strip.text = element_blank()) )
}
aaa <- list()
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=F, plot=F, only_slope = T, line_zero=F, add_confint = T)
}
aaa[[1]]
aaa <- list()
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F, only_slope = T, line_zero=F, add_confint = T)
}
aaa[[1]]
lapply(aaa, function(i) cbind(i, gsub("/.*", "", i$LogR)))
lapply(aaa, function(i) cbind(i, gsub("/.*", "", numeratorLogR=i$LogR)))
lapply(aaa, function(i) cbind(i, numeratorLogR=gsub("/.*", "", i$LogR)))
aaa <- lapply(aaa, function(i) cbind(i, numeratorLogR=gsub("/.*", "", i$LogR)))
aaa <- lapply(names(aaa), function(i) cbind(aaa[i], ct=i))
aaa
aaa <- list()
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F, only_slope = T, line_zero=F, add_confint = T)
}
aaa <- lapply(aaa, function(i) cbind(i, numeratorLogR=gsub("/.*", "", i$LogR)))
aaa <- lapply(names(aaa), function(i) cbind(aaa[[i]], ct=i))
aaa
aaa <- list()
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=F, plot=F, only_slope = T, line_zero=F, add_confint = T)
}
aaa
aaa <- list()
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F, only_slope = T, line_zero=F, add_confint = T)
}
aaa
aaa <- lapply(aaa, function(i) gsub("/.*", "", i$LogR))
aaa
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F, only_slope = T, line_zero=F, add_confint = T)
}
aaa <- lapply(aaa, function(i) cbind(numerator_LogR = gsub("/.*", "", i$LogR)))
aaa
for(ct in names(diagRE_DMDL_nonexo_SP)){
.betas_ct_it <- data.frame(plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]],
names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F))
.slopes_minpert <- .betas_ct_it %>% dplyr::filter(type_beta == "Slope") %>% dplyr::select(Estimate) %>% unlist()
aaa[[ct]] <- plot_betas(TMB_obj = diagRE_DMDL_nonexo_SP[[ct]], names_cats= logR_nonexo_notsorted_SP[[ct]],
return_df=T, plot=F, only_slope = T, line_zero=F, add_confint = T)
}
aaa <- lapply(aaa, function(i) cbind(i, numerator_LogR = gsub("/.*", "", i$LogR)))
aaa
aaa <- lapply(names(aaa), function(i) cbind(aaa[[i]], ct=i))
aaa
dcast(LogR~ct)
dcast(aaa, formula = LogR~ct)
dcast(aaa, formula = numerator_LogR~ct)
aaa
aaa <- do.call('rbind', aaa)
dcast(aaa, formula = numerator_LogR~ct)
dcast(aaa, formula = Estimate~ct+numerator_LogR)
dcast(aaa, formula = Estimate~ct)
dcast(aaa, formula = numerator_LogR~ct, value.var = Estimate)
dcast(aaa, formula = numerator_LogR~ct, value.var = 'Estimate')
aaa_dcast <- dcast(aaa, formula = numerator_LogR~ct, value.var = 'Estimate')
rownames(aaa_dcast) <- aaa_dcast$Estimate
aaa_dcast <- aaa_dcast[,-1]
View(aaa_dcast)
aaa_dcast <- dcast(aaa, formula = numerator_LogR~ct, value.var = 'Estimate')
rownames(aaa_dcast) <- aaa_dcast$numerator_LogR
aaa_dcast <- aaa_dcast[,-1]
View(aaa_dcast)
pairs(aaa_dcast)
aaa_dcast
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), function(i,j) cor(aaa_dcast[,i], aaa_dcast[,j]))
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j) cor(aaa_dcast[,i], aaa_dcast[,j])))
na.action
?na.action
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
cor(na.omit(aaa_dcast[,i], aaa_dcast[,j]))}))
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
na.omit(cor(aaa_dcast[,i], aaa_dcast[,j]))}))
i=1
j=2
na.omit(cor(aaa_dcast[,i], aaa_dcast[,j]))
?cor
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
cor(aaa_dcast[,i], aaa_dcast[,j], use = "complete.obs")}))
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
cor(aaa_dcast[,i], aaa_dcast[,j], use = "complete.obs")}))
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
cor(aaa_dcast[,i], aaa_dcast[,j], use = "all.obs")}))
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
cor(aaa_dcast[,i], aaa_dcast[,j], use = "all.obs")}))
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[,i], aaa_dcast[,j], use = "complete.obs")})))
outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[,i], aaa_dcast[,j], use = "complete.obs"))}))
cors <- outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[,i], aaa_dcast[,j], use = "complete.obs"))}))
cors
dim(cors)
cors <- apply(cors, 2, as.numeric)
cors
pheatmap::pheatmap(cors)
cors[is.na(cors)] = 0
pheatmap::pheatmap(cors)
aaa_dcast
dim(aaa_dcast)
cors <- outer(1:nrow(aaa_dcast), 1:nrow(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[i,], aaa_dcast[j,], use = "complete.obs"))}))
cors <- apply(cors, 2, as.numeric)
cors[is.na(cors)] = 0
rownames(nrow)
rownames(aaa_dcast)
rownames(cors) <- colnames(cors) <- rownames(aaa_dcast)
pheatmap::pheatmap(cors)
cors
View(aaa_dcast)
aaa_dcast[i,]
cors <- outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[,i], aaa_dcast[,j], use = "complete.obs"))}))
cors <- apply(cors, 2, as.numeric)
cors[is.na(cors)] = 0
rownames(cors) <- colnames(cors) <- colnames(aaa_dcast)
cors <- outer(1:nrow(aaa_dcast), 1:nrow(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[i,], aaa_dcast[j,], use = "complete.obs"))}))
cors_sigs <- outer(1:nrow(aaa_dcast), 1:nrow(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[i,], aaa_dcast[j,], use = "complete.obs"))}))
cors <- apply(cors, 2, as.numeric)
cors <- outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[,i], aaa_dcast[,j], use = "complete.obs"))}))
cors <- apply(cors, 2, as.numeric)
cors[is.na(cors)] = 0
rownames(cors) <- colnames(cors) <- colnames(aaa_dcast)
pheatmap::pheatmap(cors)
pheatmap::pheatmap(cors)
pdf("../../results/results_TMB/pcawg/correlation_cancertypes_from_betaslopes.pfd")
pheatmap::pheatmap(cors)
dev.off()
system("open ../../results/results_TMB/pcawg/")
dev.off()
pdf("../../results/results_TMB/pcawg/correlation_cancertypes_from_betaslopes.pdf")
pheatmap::pheatmap(cors)
dev.off()
cors_sigs <- outer(1:nrow(aaa_dcast), 1:nrow(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[i,], aaa_dcast[j,], use = "complete.obs"))}))
View(cors_sigs)
cors_sigs
View(aaa_dcast)
rownames(aaa_dcast)
i=8
j=9
cors_sigs <- outer(1:nrow(aaa_dcast), 1:nrow(aaa_dcast), Vectorize(function(i,j){
try(cor(aaa_dcast[i,], aaa_dcast[j,], use = "complete.obs"))}))
rbind(aaa_dcast[i,], aaa_dcast[j,])
cor(aaa_dcast[i,], aaa_dcast[j,], use = "complete.obs")
cor(aaa_dcast[i,], aaa_dcast[j,])
cor(aaa_dcast[i,], aaa_dcast[j,], use = "all.obs")
?cor
cor(aaa_dcast[i,], aaa_dcast[j,], use = "everything")
cor(aaa_dcast[i,], aaa_dcast[j,], use = "everything")
cor(rbind(aaa_dcast[i,], aaa_dcast[j,]), use = "everything")
cor(cbind(aaa_dcast[i,], aaa_dcast[j,]), use = "everything")
cor(aaa_dcast[i,], aaa_dcast[j,], use = "complete.obs")
cor(aaa_dcast[i,], aaa_dcast[j,], use = "pairwise.complete.obs")
cor(x = as.vector(aaa_dcast[i,]), y = as.vector(aaa_dcast[j,]), use = "pairwise.complete.obs")
i
9
as.vector(aaa_dcast[i,])
cor(x = runif(9), y = runif(9), use = "pairwise.complete.obs")
aaa_dcast[i,]
cor(x = as.vector(aaa_dcast[i,]), y = as.vector(aaa_dcast[j,]))
cor(x = unlist(aaa_dcast[i,]), y = unlist(aaa_dcast[j,]))
cor(x = unlist(aaa_dcast[i,]), y = unlist(aaa_dcast[j,]), use = "pairwise.complete.obs")
cors <- outer(1:ncol(aaa_dcast), 1:ncol(aaa_dcast), Vectorize(function(i,j){
try(cor(x = unlist(aaa_dcast[,i]), y = unlist(aaa_dcast[,j]), use = "pairwise.complete.obs"))}))
cors <- apply(cors, 2, as.numeric)
cors[is.na(cors)] = 0
rownames(cors) <- colnames(cors) <- colnames(aaa_dcast)
pdf("../../results/results_TMB/pcawg/correlation_cancertypes_from_betaslopes.pdf")
pheatmap::pheatmap(cors)
dev.off()
cors_sigs <- outer(1:nrow(aaa_dcast), 1:nrow(aaa_dcast), Vectorize(function(i,j){
try(cor(x = unlist(aaa_dcast[i,]), y = unlist(aaa_dcast[j,]), use = "pairwise.complete.obs"))}))
cors_sigs <- apply(cors_sigs, 2, as.numeric)
cors_sigs[is.na(cors_sigs)] = 0
rownames(cors_sigs) <- colnames(cors_sigs) <- rownames(aaa_dcast)
pheatmap::pheatmap(cors)
pheatmap::pheatmap(cors_sigs)
pdf("../../results/results_TMB/pcawg/correlation_signatures_from_betaslopes.pdf")
pheatmap::pheatmap(cors_sigs)
dev.off()
dev.off()
pdf("../../results/results_TMB/pcawg/correlation_signatures_from_betaslopes.pdf")
print(pheatmap::pheatmap(cors_sigs))
dev.off()
nonexogenous = read.table("../../data/cosmic/exogenous_signatures_SBS.txt", sep = "\t",
comment.char = "#", fill = F)
nonexogenous
nonexogenous$V1
cors_sigs
rownames(cors_sigs) <- colnames(cors_sigs) <- paste0('SBS', rownames(aaa_dcast))
nonexogenous = read.table("../../data/cosmic/exogenous_signatures_SBS.txt", sep = "\t",
comment.char = "#", fill = F)
nonexogenous
rownames(cors_sigs) %in% nonexogenous$V1
(rownames(cors_sigs) %in% nonexogenous$V1) & !(rownames(cors_sigs) %in% c('SBS1', 'SBS5'))
(rownames(cors_sigs) %in% nonexogenous$V1)
rownames(cors_sigs)
nonexogenous$V1
print(pheatmap::pheatmap(cors, color = viridis::inferno(10)))
=======
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
head(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$seqname
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
head(DM_areas2)
colnames(DM_areas2)[1] <- 'seqname'
gsub(" ", "", DM_areas2$seqname)
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$start <- as.numeric(DM_areas2$start)
DM_areas2$end <- as.numeric(DM_areas2$end)
DM_areas2$seqname <- gtools::mixedsort(DM_areas2$seqname)
DM_areas2_GR <- as(DM_areas2, "GRanges")
disjoined_GR2_genes <- disjoin(c(grch38_genes, DM_areas2_GR), with.revmap=T, ignore.strand=T)
revmap_second2 <- sapply(disjoined_GR2_genes$revmap, function(i) i[i > length(grch38_genes)])
revmap_second_idx2 <- sapply(revmap_second2, function(i) i-length(grch38_genes))
revmap_second_idx2[sapply(revmap_second_idx2, length) == 0] <- NA
revmap_second_idx2 <- (unlist(revmap_second_idx2))
length(revmap_second_idx2)
disjoined_GR2_genes$value_DM = as.numeric(DM_areas2$value[revmap_second_idx2])
disjoined_GR2_genes$value_DM[is.na(disjoined_GR2_genes$value_DM )] = 0
disjoined_GR2_genes$pval_DM = DM_areas2$`p-value`[revmap_second_idx2]
revmap_uniq2 <- unique(unlist(revmap_second2))
length(revmap_uniq2)
length(DM_areas2_GR)
min((revmap_second_idx2), na.rm = T)
max((revmap_second_idx2), na.rm = T)
disjoined_GR2_genes_df <- as(disjoined_GR2_genes, 'data.frame')
disjoined_GR2_genes_merged <- unlist(reduce(split(disjoined_GR2_genes, ~value_DM)))
disjoined_GR2_genes_merged$value_DM <- as.numeric(names(disjoined_GR2_genes_merged))
disjoined_GR2_genes_merged_df <- as(disjoined_GR_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(1:21, 'X', 'Y') ,]
dim(disjoined_GR2_genes_merged_df)
ggplot(disjoined_GR2_genes_merged_df[1:100,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
head(disjoined_GR2_genes_merged_df)
ggplot(disjoined_GR2_genes_merged_df[1:1000,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged
dim(disjoined_GR2_genes_merged)
length(disjoined_GR2_genes_merged)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged
disjoined_GR2_genes_merged <- unlist(reduce(split(disjoined_GR2_genes, ~value_DM)))
disjoined_GR2_genes_merged$value_DM <- as.numeric(names(disjoined_GR2_genes_merged))
names(disjoined_GR2_genes_merged) <- NULL
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(1:21, 'X', 'Y') ,]
ggplot(disjoined_GR2_genes_merged_df[1:1000,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
length(disjoined_GR2_genes_merged_df)
dim(disjoined_GR2_genes_merged_df)
dim(disjoined_GR_genes_merged_df)
ggplot(disjoined_GR2_genes_merged_df[1:1000,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$value_DM
table(disjoined_GR2_genes_merged_df$value_DM)
disjoined_GR2_genes$value_DM
table(disjoined_GR2_genes$value_DM)
disjoined_GR2_genes
disjoined_GR2_genes_merged <- unlist(reduce(split(disjoined_GR2_genes, ~value_DM)))
disjoined_GR2_genes_merged
as.numeric(names(disjoined_GR2_genes_merged))
max()
max(as.numeric(names(disjoined_GR2_genes_merged)))
disjoined_GR2_genes_merged$value_DM <- as.numeric(names(disjoined_GR2_genes_merged))
names(disjoined_GR2_genes_merged) <- NULL
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$value_DM
max(disjoined_GR2_genes_merged_df$value_DM)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(1:21, 'X', 'Y') ,]
max(disjoined_GR2_genes_merged_df$value_DM)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df$seqnames <- paste0('chr', genes_of_interest_df$seqnames)
genes_of_interest_df <- as(genes_of_interest, 'data.frame')
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
genes_of_interest_df_chr$seqnames
dev.off()
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
ggplot(disjoined_GR_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
evels(disjoined_GR2_genes_merged_df$seqnames)
gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames))
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
unique(factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames))))
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
genes_of_interest_df_chr$seqnames
levels(disjoined_GR2_genes_merged_df$seqnames )
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
levels(disjoined_GR2_genes_merged_df$seqnames)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(unique(disjoined_GR2_genes_merged_df$seqnames))))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
unique(disjoined_GR2_genes_merged_df$seqnames)
levels(disjoined_GR2_genes_merged_df$seqnames)
gtools::mixedsort(levels(unique(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
gtools::mixedsort(levels(unique(disjoined_GR2_genes_merged_df$seqnames)))
gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
levels(disjoined_GR2_genes_merged_df$seqnames) <- gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
levels(disjoined_GR2_genes_merged_df$seqnames)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
as.character(gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames)))
levels(disjoined_GR2_genes_merged_df$seqnames) <- as.character(gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames)))
droplevels(disjoined_GR2_genes_merged_df)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
disjoined_GR2_genes_merged_df <- droplevels(disjoined_GR2_genes_merged_df)
levels(disjoined_GR2_genes_merged_df$seqnames) <- as.character(gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames)))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
levels(genes_of_interest_df_chr$seqnames)
levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
genes_of_interest_df_chr$seqnames
genes_of_interest_df_chr$seqnames <- factor(genes_of_interest_df_chr$seqnames,
levels=levels(disjoined_GR2_genes_merged_df$seqnames ))
genes_of_interest_df_chr$seqnames
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
genes_of_interest_df_chr
##-----------------------------------------------------------------------------------------------------##
rm(list = ls())
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
##-----------------------------------------------------------------------------------------------------##
##-----------------------------------------------------------------------------------------------------##
source("../2_inference_TMB/helper_TMB.R")
source("../../../CDA_in_Cancer/code/functions/meretricious/pretty_plots/prettySignatures.R")
source("../3_analysis/recovery_COSMIC_signatures/recover_COSMIC_signatures.R")
library(TMB)
library(ggrepel)
library(cowplot)
library(gridExtra)
library(dplyr)
##-----------------------------------------------------------------------------------------------------##
##-----------------------------------------------------------------------------------------------------##
enough_samples = read.table("../../data/restricted/pcawg/CT_sufficient_samples.txt", comment.char='#')[,1]
enough_samples
nonexogenous = read.table("../../data/cosmic/exogenous_signatures_SBS.txt", sep = "\t",
comment.char = "#", fill = F)
nonexogenouswSBS1SBS5 = read.table("../../data/cosmic/exogenous_signatures_SBS_withSBS1SBS5.txt", sep = "\t",
comment.char = "#", fill = F)
##-----------------------------------------------------------------------------------------------------##
##-----------------------------------------------------------------------------------------------------##
read_info <- function(ct){
.x <- list(fullRE_M_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREM_", ct, "_signaturesPCAWG.RDS"))),
fullRE_DMSL_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREDMsinglelambda_", ct, "_signaturesPCAWG.RDS"))),
fullRE_M_nonexo_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREMnonexo_", ct, "_signaturesPCAWG.RDS"))),
fullRE_DMSL_nonexo_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREDMsinglelambdanonexo_", ct, "_signaturesPCAWG.RDS"))),
diagRE_DMDL_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/diagREDM_", ct, "_signaturesPCAWG.RDS"))),
diagRE_DMDL_nonexo_SP =  try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/diagREDMnonexo_", ct, "_signaturesPCAWG.RDS"))),
diagRE_DMDL_wSBS1SBS5nonexo_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/diagREDMwSBS1SBS5nonexo_", ct, "_signaturesPCAWG.RDS"))),
fullREDMnoscaling_SP_nonexo =  try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREDMnoscalingnonexo_", ct, "_signaturesPCAWG.RDS"))),
fullREDMnoscaling_SP_nonexo_subsets_and_amalgamations <- try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREDMnoscalingnonexosubset_", ct, "_signaturesPCAWG.RDS"))),
fullREDMonefixedlambdanonexo_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREDMonefixedlambdanonexo_", ct, "_signaturesPCAWG.RDS"))),
fullREDMonefixedlambda2nonexo_SP = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREDMonefixedlambda2nonexo_", ct, "_signaturesPCAWG.RDS"))),
fullREDMonefixedlambdanonexo_SPSaA = try(readRDS(paste0("../../data/pcawg_robjects_cache/tmb_results/nlminb/fullREDMonefixedlambdanonexo_", ct, "_signaturesPCAWGSaA.RDS"))),
dataset_all_sigs = load_PCAWG(ct = ct, typedata = "signaturesPCAWG", path_to_data = "../../data/"),
dataset_active_sigs = load_PCAWG(ct = ct, typedata = "signaturesPCAWG", path_to_data = "../../data/"),
dataset_nucleotidesubstitution1 = load_PCAWG(ct = ct, typedata = "nucleotidesubstitution1", path_to_data = "../../data/"),
DMM = list(z_DMM=lapply(1:8, function(k) try(read.table(paste0("../../data/roo_for_DMM_SPpcawg/DMM_output/", ct, "_signaturesPCAWG_all", k, "_dmm.z"), sep = ',', skip = 1))),
fit_DMM = lapply(1:8, function(k) try(read.table(paste0("../../data/roo_for_DMM_SPpcawg/DMM_output/", ct, "_signaturesPCAWG_all", k, "_dmm.fit"), sep = ' '))))
)
.x$dataset_nonexo <- give_subset_sigs_TMBobj(.x$dataset_all_sigs, nonexogenous$V1)
.x$dataset_nonexoSBS1SBS5 <- give_subset_sigs_TMBobj(.x$dataset_all_sigs, nonexogenouswSBS1SBS5$V1)
.x$colnames_notsorted_SP <- try(colnames(.x$dataset_all_sigs$Y))
.x$logR_notsorted_SP <- try(vector_cats_to_logR(.x$colnames_notsorted_SP))
.x$colnames_nonexo_notsorted_SP <- try(colnames(.x$dataset_nonexo$Y))
.x$logR_nonexo_notsorted_SP <- try(vector_cats_to_logR(.x$colnames_nonexo_notsorted_SP))
## nonexo, with SBS1 and SBS5
.x$colnames_wSBS1SBS5nonexo_notsorted_SP <- try(colnames(.x$dataset_nonexoSBS1SBS5$Y))
.x$logR_wSBS1SBS5nonexo_notsorted_SP <- try(vector_cats_to_logR(.x$colnames_wSBS1SBS5nonexo_notsorted_SP))
return(.x)
}
##-----------------------------------------------------------------------------------------------------##
##-----------------------------------------------------------------------------------------------------##
read_info_list <- lapply(enough_samples, read_info)
names(read_info_list) <- enough_samples
##-----------------------------------------------------------------------------------------------------##
plot_betas_scatter <- function(TMB_obj, names_cats=NULL, softmax=F){
betas_mat <- t(matrix(python_like_select_name(TMB_obj$par.fixed, 'beta'), nrow=2))
if(softmax){
betas_mat <- t(softmax(t(rbind(betas_mat, 0))))
names_cats <- c(sapply(names_cats, function(i) strsplit(i, '/')[[1]][1]),
strsplit(names_cats[1], '/')[[1]][2])
}
betas_df <- data.frame(betas_mat)
if(!is.null(names_cats)){
betas_df$logR = names_cats
}else{
betas_df$logR <- 1:nrow(betas_df)
}
a <- ggplot(betas_df, aes(x=X1, y=X2, label=logR))+labs(x='Beta intercept', y='Beta slope')
if(!TMB_obj$pdHess){
a <- a+geom_point(col='red')
}else{
a <- a+geom_point()
}
a <- a + geom_label_repel(size=3)+theme_bw()
return(a)
}
give_mycolours <- function(n){
n <- 60
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unique(unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals))))
myColors <- col_vector[1:n]
}
plot_scatter <- function(m){
m <- data.frame(m)
names_sigs <- colnames(m)
colnames(m) <- c('x1', 'x2')
ggplot(m, aes(x=x1, y=x2))+geom_point()+theme_bw()+labs(x=names_sigs[1], y=names_sigs[2])
}
plot_covariance_mat <- function(TMB_obj, names_cats=NULL){
.x <- L_to_cov(python_like_select_name(TMB_obj$par.fixed, 'cov_par_RE'),
d=length(python_like_select_name(TMB_obj$par.fixed, 'beta'))/2)
if(!is.null(names_cats))  colnames(.x) <- rownames(.x) <- names_cats
hm <- pheatmap::pheatmap(.x, main='Covariances')
return(arrangeGrob(hm[[4]]))
}
give_plot_differential_precision <- function(TMB_obj){
ovrdisp <- cbind.data.frame( plot_lambdas(TMB_obj, return_df=T, plot=F))
if(TMB_obj$pdHess){
col='red'
}else{
col='black'
}
ovrdisp[ovrdisp$name == 'Lambda 1','name'] = 'Early'
ovrdisp[ovrdisp$name == 'Lambda 2','name'] = 'Late'
ggplot(ovrdisp, aes(x=name,  y=`Estimate`))+
geom_point(col=col)+
geom_errorbar(aes(ymin=`Estimate`-`Std..Error`,
ymax=`Estimate`+`Std..Error`), width=.1)+
theme_bw()+
labs(x='', y='Log lambda')
}
give_DMM_plot <- function(TMB_obj){
if(all(sapply(read_info_list[[ct]]$DMM$z_DMM, typeof) == 'character')){
ggplot()+theme_bw()
}else{
ggplot(cbind(melt(normalise_rw(TMB_obj$dataset_all_sigs$Y)),
grouptiming=rep(c('Clonal','Subclonal'), each=dim(TMB_obj$dataset_all_sigs$Y)[1]/2),
groupDMM=paste0('DMM ', apply(TMB_obj$DMM$z_DMM[[which.min(unlist(sapply(TMB_obj$DMM$fit_DMM, `[`, 2)))]][,2:3], 1, which.max))),
aes(x=Var1, y=value, fill=Var2))+geom_bar(stat = "identity")+facet_wrap(.~grouptiming+groupDMM, ncol=2)+
scale_fill_manual(name = "grp",values = give_mycolours(ncol(read_info_list[[ct]]$dataset_all_sigs$Y)))+theme_bw()+
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
}
}
logR_nucleotidesubs1 <- vector_cats_to_logR(sort(unlist( sapply(c('C', 'T'),
function(base){ paste0(base, '>', c('A', 'C', 'G', 'T')[! (c('A', 'C', 'G', 'T') == base)]) }))))
betas_df_to_softmax <- function(df_betas){
.x <- softmax(c(df_betas$Estimate, 0))
names(.x) <- c(gsub("/.*", "", df_betas$LogR), gsub("*./", "", df_betas$LogR[1]))
.x
}
enough_samples
ct=enough_samples[3]
ct
.a <- give_barplot_from_obj(read_info_list[[ct]]$dataset_all_sigs, legend_on = T, legend_bottom = T, plot=F, arg_title='')
pdf(paste0("../../results/results_TMB/pcawg/reports_per_cancer_type/", ct, "_report1.pdf"), onefile=FALSE, height = 12)
print(cowplot::plot_grid(cowplot::plot_grid(.a),
cowplot::plot_grid(plot_betas(read_info_list[[ct]]$fullRE_DMSL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP, title = 'fullRE_DMSL_SP'),
plot_betas(read_info_list[[ct]]$diagRE_DMDL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP, title = 'diagRE_DMDL_SP'),
plot_betas(read_info_list[[ct]]$diagRE_DMDL_nonexo_SP, names_cats = read_info_list[[ct]]$logR_nonexo_notsorted_SP, title = 'diagRE_DMDL_nonexo_SP'),
plot_betas(read_info_list[[ct]]$diagRE_DMDL_wSBS1SBS5nonexo_SP, names_cats = read_info_list[[ct]]$logR_wSBS1SBS5nonexo_notsorted_SP, title = 'diagRE_DMDL_wSBS1SBS5nonexo_SP')),
cowplot::plot_grid(plot_betas_scatter(read_info_list[[ct]]$diagRE_DMDL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP),
plot_betas_scatter(read_info_list[[ct]]$diagRE_DMDL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP, softmax=T)),
cowplot::plot_grid(cowplot::plot_grid(createBarplot(normalise_rw(non_duplicated_rows(read_info_list[[ct]]$dataset_all_sigs$Y)),
order_labels = names(sort(rowSums(non_duplicated_rows(read_info_list[[ct]]$dataset_all_sigs$Y)),
decreasing = F)), remove_labels=T)+guides(fill=F)+ggtitle('Sorted by mut. toll'),
give_plot_differential_precision(read_info_list[[ct]]$diagRE_DMDL_SP), ncol=1),
plot_covariance_mat(read_info_list[[ct]]$fullRE_DMSL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP)),
nrow=4, rel_heights = c(2,2,1,2)))
dev.off()
dev.off()
pdf(paste0("../../results/results_TMB/pcawg/reports_per_cancer_type/", ct, "_report1.pdf"), onefile=FALSE, height = 12)
print(cowplot::plot_grid(cowplot::plot_grid(.a),
cowplot::plot_grid(plot_betas(read_info_list[[ct]]$fullRE_DMSL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP, title = 'fullRE_DMSL_SP'),
plot_betas(read_info_list[[ct]]$diagRE_DMDL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP, title = 'diagRE_DMDL_SP'),
plot_betas(read_info_list[[ct]]$diagRE_DMDL_nonexo_SP, names_cats = read_info_list[[ct]]$logR_nonexo_notsorted_SP, title = 'diagRE_DMDL_nonexo_SP'),
plot_betas(read_info_list[[ct]]$diagRE_DMDL_wSBS1SBS5nonexo_SP, names_cats = read_info_list[[ct]]$logR_wSBS1SBS5nonexo_notsorted_SP, title = 'diagRE_DMDL_wSBS1SBS5nonexo_SP')),
cowplot::plot_grid(plot_betas_scatter(read_info_list[[ct]]$diagRE_DMDL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP),
plot_betas_scatter(read_info_list[[ct]]$diagRE_DMDL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP, softmax=T)),
cowplot::plot_grid(cowplot::plot_grid(createBarplot(normalise_rw(non_duplicated_rows(read_info_list[[ct]]$dataset_all_sigs$Y)),
order_labels = names(sort(rowSums(non_duplicated_rows(read_info_list[[ct]]$dataset_all_sigs$Y)),
decreasing = F)), remove_labels=T)+guides(fill=F)+ggtitle('Sorted by mut. toll'),
give_plot_differential_precision(read_info_list[[ct]]$diagRE_DMDL_SP), ncol=1),
plot_covariance_mat(read_info_list[[ct]]$fullRE_DMSL_SP, names_cats = read_info_list[[ct]]$logR_notsorted_SP)),
nrow=4, rel_heights = c(2,2,1,2)))
>>>>>>> b7516544d6581da5bf0a960e309788c1fba6dff6
dev.off()
