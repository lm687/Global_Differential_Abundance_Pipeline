genes_of_interest <- grch38_genes[unlist(sapply(gene_vec, function(i) which(grch38_genes$gene_name == i)))]
genes_of_interest_df <- as(genes_of_interest, 'data.frame')
ggplot(disjoined_GR_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC.pdf", height = 10, width = 10)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas)
DM_areas2
head(DM_areas2)
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
length(DM_areas2)
DM_areas2 <- matrix(unlist(DM_areas[,1]), ncol=6, byrow=T)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
DM_areas2
dim(DM_areas2)
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
View(DM_areas2)
##' Long-range "open seas" with significant differential methylation signatures. Negative methylation
##' values represent hypo- methylation in HGSOC compared with fallopian tube controls. Chromosome
##' coordinates are GRCh38 numbers.
DM_areas <- read.table("~/Desktop/DME.txt", sep = "\t", stringsAsFactors = F)
DM_areas <- matrix(unlist(DM_areas[,1]), ncol=6, byrow=T)
DM_areas <- data.frame(DM_areas)
colnames(DM_areas) <- DM_areas[1,]; DM_areas <- DM_areas[-1,]
View(DM_areas)
colnames(DM_areas)
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2_GR <- as(DM_areas2, "GRanges")
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$Start <- as.numeric(DM_areas2$Start)
DM_areas2
head(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas[1,]; DM_areas2 <- DM_areas2[-1,]
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$Start <- as.numeric(DM_areas2$Start)
DM_areas2
head(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
head(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$Start <- as.numeric(DM_areas2$Start)
head(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$Start <- as.numeric(DM_areas2$Start)
DM_areas2
as.numeric(DM_areas2$Start)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
head(DM_areas2)
DM_areas2$start <- as.numeric(DM_areas2$start)
DM_areas2$end <- as.numeric(DM_areas2$end)
DM_areas2$seqname <- gtools::mixedsort(DM_areas2$seqname)
DM_areas2_GR <- as(DM_areas2, "GRanges")
head(DM_areas2)
DM_areas2_GR <- as(DM_areas2, "GRanges")
head(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
head(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$seqname
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
head(DM_areas2)
colnames(DM_areas2)[1] <- 'seqname'
gsub(" ", "", DM_areas2$seqname)
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
DM_areas2 <- read.table("~/Desktop/DME2.txt", sep = "\t", stringsAsFactors = F)
DM_areas2 <- matrix(unlist(DM_areas2[,1]), ncol=6, byrow=T)
DM_areas2 <- data.frame(DM_areas2)
colnames(DM_areas2) <- DM_areas2[1,]; DM_areas2 <- DM_areas2[-1,]
View(DM_areas2)
colnames(DM_areas2)[1] <- 'seqname'
DM_areas2$seqname <- gsub(" ", "", DM_areas2$seqname)
DM_areas2$start <- as.numeric(DM_areas2$start)
DM_areas2$end <- as.numeric(DM_areas2$end)
DM_areas2$seqname <- gtools::mixedsort(DM_areas2$seqname)
DM_areas2_GR <- as(DM_areas2, "GRanges")
disjoined_GR2_genes <- disjoin(c(grch38_genes, DM_areas2_GR), with.revmap=T, ignore.strand=T)
revmap_second2 <- sapply(disjoined_GR2_genes$revmap, function(i) i[i > length(grch38_genes)])
revmap_second_idx2 <- sapply(revmap_second2, function(i) i-length(grch38_genes))
revmap_second_idx2[sapply(revmap_second_idx2, length) == 0] <- NA
revmap_second_idx2 <- (unlist(revmap_second_idx2))
length(revmap_second_idx2)
disjoined_GR2_genes$value_DM = as.numeric(DM_areas2$value[revmap_second_idx2])
disjoined_GR2_genes$value_DM[is.na(disjoined_GR2_genes$value_DM )] = 0
disjoined_GR2_genes$pval_DM = DM_areas2$`p-value`[revmap_second_idx2]
revmap_uniq2 <- unique(unlist(revmap_second2))
length(revmap_uniq2)
length(DM_areas2_GR)
min((revmap_second_idx2), na.rm = T)
max((revmap_second_idx2), na.rm = T)
disjoined_GR2_genes_df <- as(disjoined_GR2_genes, 'data.frame')
disjoined_GR2_genes_merged <- unlist(reduce(split(disjoined_GR2_genes, ~value_DM)))
disjoined_GR2_genes_merged$value_DM <- as.numeric(names(disjoined_GR2_genes_merged))
disjoined_GR2_genes_merged_df <- as(disjoined_GR_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(1:21, 'X', 'Y') ,]
dim(disjoined_GR2_genes_merged_df)
ggplot(disjoined_GR2_genes_merged_df[1:100,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
head(disjoined_GR2_genes_merged_df)
ggplot(disjoined_GR2_genes_merged_df[1:1000,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged
dim(disjoined_GR2_genes_merged)
length(disjoined_GR2_genes_merged)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged
disjoined_GR2_genes_merged <- unlist(reduce(split(disjoined_GR2_genes, ~value_DM)))
disjoined_GR2_genes_merged$value_DM <- as.numeric(names(disjoined_GR2_genes_merged))
names(disjoined_GR2_genes_merged) <- NULL
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(1:21, 'X', 'Y') ,]
ggplot(disjoined_GR2_genes_merged_df[1:1000,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
length(disjoined_GR2_genes_merged_df)
dim(disjoined_GR2_genes_merged_df)
dim(disjoined_GR_genes_merged_df)
ggplot(disjoined_GR2_genes_merged_df[1:1000,])+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$value_DM
table(disjoined_GR2_genes_merged_df$value_DM)
disjoined_GR2_genes$value_DM
table(disjoined_GR2_genes$value_DM)
disjoined_GR2_genes
disjoined_GR2_genes_merged <- unlist(reduce(split(disjoined_GR2_genes, ~value_DM)))
disjoined_GR2_genes_merged
as.numeric(names(disjoined_GR2_genes_merged))
max()
max(as.numeric(names(disjoined_GR2_genes_merged)))
disjoined_GR2_genes_merged$value_DM <- as.numeric(names(disjoined_GR2_genes_merged))
names(disjoined_GR2_genes_merged) <- NULL
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$value_DM
max(disjoined_GR2_genes_merged_df$value_DM)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(1:21, 'X', 'Y') ,]
max(disjoined_GR2_genes_merged_df$value_DM)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df$seqnames <- paste0('chr', genes_of_interest_df$seqnames)
genes_of_interest_df <- as(genes_of_interest, 'data.frame')
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
genes_of_interest_df_chr$seqnames
dev.off()
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
ggplot(disjoined_GR_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
evels(disjoined_GR2_genes_merged_df$seqnames)
gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames))
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
unique(factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames))))
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(disjoined_GR2_genes_merged_df$seqnames)))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
genes_of_interest_df_chr$seqnames
levels(disjoined_GR2_genes_merged_df$seqnames )
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
levels(disjoined_GR2_genes_merged_df$seqnames)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
disjoined_GR2_genes_merged_df$seqnames <- factor(disjoined_GR2_genes_merged_df$seqnames,
levels=gtools::mixedsort(levels(unique(disjoined_GR2_genes_merged_df$seqnames))))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
unique(disjoined_GR2_genes_merged_df$seqnames)
levels(disjoined_GR2_genes_merged_df$seqnames)
gtools::mixedsort(levels(unique(disjoined_GR2_genes_merged_df$seqnames)))
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
gtools::mixedsort(levels(unique(disjoined_GR2_genes_merged_df$seqnames)))
gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
levels(disjoined_GR2_genes_merged_df$seqnames) <- gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
levels(disjoined_GR2_genes_merged_df$seqnames)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames))
as.character(gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames)))
levels(disjoined_GR2_genes_merged_df$seqnames) <- as.character(gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames)))
droplevels(disjoined_GR2_genes_merged_df)
disjoined_GR2_genes_merged_df <- as(disjoined_GR2_genes_merged, 'data.frame')
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[with(disjoined_GR2_genes_merged_df, order(seqnames, start)), ]
disjoined_GR2_genes_merged_df <- disjoined_GR2_genes_merged_df[disjoined_GR2_genes_merged_df$seqnames %in% c(paste0('chr', c(1:21, 'X', 'Y'))) ,]
disjoined_GR2_genes_merged_df <- droplevels(disjoined_GR2_genes_merged_df)
levels(disjoined_GR2_genes_merged_df$seqnames) <- as.character(gtools::mixedsort(unique(disjoined_GR2_genes_merged_df$seqnames)))
genes_of_interest_df_chr <- genes_of_interest_df
genes_of_interest_df_chr$seqnames <- paste0('chr', genes_of_interest_df_chr$seqnames)
levels(genes_of_interest_df_chr$seqnames) <- levels(disjoined_GR2_genes_merged_df$seqnames )
levels(genes_of_interest_df_chr$seqnames)
levels(disjoined_GR2_genes_merged_df$seqnames )
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
disjoined_GR2_genes_merged_df$seqnames
genes_of_interest_df_chr$seqnames
genes_of_interest_df_chr$seqnames <- factor(genes_of_interest_df_chr$seqnames,
levels=levels(disjoined_GR2_genes_merged_df$seqnames ))
genes_of_interest_df_chr$seqnames
ggplot(disjoined_GR2_genes_merged_df)+
geom_segment(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_line(aes(x=start, xend=end, y=value_DM, yend=value_DM))+
geom_label_repel(data=genes_of_interest_df_chr, aes(x=start, y= 0, label=gene_name), size=3)+
geom_point(col='red', data=genes_of_interest_df_chr, aes(x=start, y= 0))+
facet_wrap(~seqnames, scales = "free")+theme_bw()
ggsave("~/Desktop/differential_methylation_HGSOC_relapse.pdf", height = 10, width = 10)
genes_of_interest_df_chr
## simulated data with different implementations of the overdispersion parameter
rm(list = ls())
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
set.seed(1234)
library(compositions)
library(HMP)
source("../../2_inference_TMB/helper_TMB.R")
a <- runif(100); b <- a+runif(100, min = -0.4, max=0.2); sigma <- cov(cbind(a,b))
sigma
beta <- rbind(c(0.5, 0.6), c(0.3, -1))
## simulate log-ratios
n <- 1000
## sample random intercepts
u <- mvtnorm::rmvnorm(n, mean=c(0,0), sigma = sigma)
x <- cbind(1, c(rep(0, n),rep(1, n)))
z <- give_z_matrix(n*2)
logR <- x %*% beta + z %*% u
probs <- softmax(cbind(logR, 0))
plot(compositions::acomp(probs), col=factor(x[,2]))
## add two overdispersion parameters
lambda_b <- c(9,6)
alpha_OVERDISPb <- rep(lambda_b, each=n)*probs
alpha_OVERDISPb
lambda_c
lambda_c
alpha_OVERDISPc <- rep(c(200,6), each=n)*probs
probs
beta
## why we need two betas
beta[2,] <- c(0,0)
logR <- x %*% beta + z %*% u
probs <- softmax(cbind(logR, 0))
alpha_OVERDISPc <- rep(c(200,6), each=n)*probs
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
split_matrix_in_half(alpha_OVERDISPc)
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[1]])
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[2]])
alpha_OVERDISPc <- rep(c(20,2), each=n)*probs
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[1]])
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[2]])
alpha_OVERDISPc <- rep(c(20,0.1), each=n)*probs
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[1]])
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[2]])
par(mfrow=c(1,2))
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[1]])
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[2]])
alpha_OVERDISPc <- rep(c(20,0.1), each=n)*probs
par(mfrow=c(1,2))
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[1]])
plot_ternary(split_matrix_in_half(alpha_OVERDISPc)[[2]])
split_matrix_in_half
alpha_OVERDISPc
alpha_OVERDISPc <- give_DM(rep(c(20,0.1), each=n)*probs)
## get DM counts
give_DM <- function(alpha, Nm){
t(sapply(1:nrow(alpha), function(i){
HMP::Dirichlet.multinomial(Nrs = Nm[i], shape = alpha[i,] )
}))
}
Nm <- rep(90, n*2)
alpha_OVERDISPc <- give_DM(rep(c(20,0.1), each=n)*probs, Nm = rep(90, n*2))
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
alpha_OVERDISPc <- give_DM(rep(c(60,3), each=n)*probs, Nm = rep(90, n*2))
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
alpha_OVERDISPc <- give_DM(rep(c(60,30), each=n)*probs, Nm = rep(90, n*2))
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
alpha_OVERDISPc <- give_DM(rep(c(600,30), each=n)*probs, Nm = rep(90, n*2))
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
alpha_OVERDISPc <- give_DM(rep(c(800,30), each=n)*probs, Nm = rep(90, n*2))
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
pdf(file = "../../../results/models_explanatory/DM_parameters_and_identifiability_why_differential_precision.pdf", heigh=3)
par(mfrow=c(1,2), mar=c(0,0,0,0))
sapply(split_matrix_in_half(alpha_OVERDISPc), plot_ternary, legend_on=F, plot_points=F)
dev.off()
